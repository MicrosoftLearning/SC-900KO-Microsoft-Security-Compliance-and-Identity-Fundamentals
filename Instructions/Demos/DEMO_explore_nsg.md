---
Demo:
    title: 'Azure NSG(네트워크 보안 그룹)'
    module: '모듈 3 단원 1: Microsoft 보안 솔루션의 기능 설명: Azure의 기본적인 보안 기능 설명'
---

# 데모: Azure NSG(네트워크 보안 그룹)

### 데모 시나리오
이 데모에서는 Azure의 NSG(네트워크 보안 그룹) 기능을 살펴봅니다.  먼저 데모 전 설정의 일환으로 NSG가 없는 VM(가상 머신)을 만듭니다. 그리고 인터페이스나 서브넷이 연결되지 않은 NSG도 만듭니다.  데모에서는 NSG용 기본 인바운드 및 아웃바운드 규칙을 살펴봅니다. 그런 다음 NSG에 VM 인터페이스를 할당하는 프로세스를 진행합니다.  VM에 대한 연결 구성을 완료한 후 기본 NSG 규칙 및 직접 만들 규칙을 사용하여 해당 연결을 테스트합니다.
  

#### 데모 전 설정 1부:
 VM을 만들려면 몇 분 정도 걸릴 수 있으므로, 강사는 강의 시간 **전에** 이 작업을 수행하는 것이 좋습니다. 이 설정에서는 Windows 10 가상 머신을 만듭니다.

1. 브라우저에서 **홈 – Microsoft Azure** 탭을 엽니다.  이전에 해당 탭을 닫았다면 브라우저 페이지를 열고 주소 표시줄에 portal.azure.com을 입력하여 다시 로그인합니다.

1. 검색 상자(페이지 위쪽의 'Microsoft Azure' 옆에 있는 파란 막대)에 **가상 머신**을 입력하고 검색 결과에서 **가상 머신**을 선택합니다.  

1. 페이지 왼쪽 위에서 **+추가**를 선택하고 **+가상 머신**을 선택합니다.

1. 기본 탭에서 다음 정보를 입력합니다(아래에 나와 있지 않은 옵션의 경우 기본 설정 유지).
    1. **구독**: 기본 설정인 Azure Pass - 스폰서쉽이 선택되어 있는지 확인합니다.
    1. **리소스 그룹**: **새로 만들기**를 선택하고 이름 필드에 **LabsSC900-RG**를 입력한 다음 **확인**을 선택합니다.
    1. **가상 머신 이름**:  **SC900-WinVM**을 입력합니다.
    1. **지역**:  기본값을 그대로 둡니다.
    1. **가용성 옵션**: **인프라 중복이 필요하지 않습니다.** 를 선택합니다.  참고: 가용성 옵션은 반드시 인프라 중복이 필요하지 않습니다.로 설정해야 합니다. 이렇게 하지 않으면 데모가 정상적으로 작동하지 않습니다.  가용성 옵션을 사용하려면 NSG가 필요한데, 여기서는 의도적으로 NSG가 없는 VM을 만들 것입니다.
    1. **이미지**:  드롭다운에서 **Windows 10 Pro, 버전 20H2 – 1세대**를 선택합니다.
    1. **크기**:  드롭다운에서 **모든 크기 보기**를 선택하고 **B2s**를 선택한 후 페이지 아래쪽에서 **선택**을 누릅니다.
    1. **사용자 이름**:  **AzureUser**를 입력합니다.
    1. **암호**:  **SC900AzureLabs**를 입력합니다.
    1. **공용 인바운드 포트**:  기본 설정을 그대로 두면 됩니다(여기서 어떤 설정을 선택하든 네트워크 설정에 의해 재정의됨).
    1. **라이선스**:  **다중 테넌트 호스팅 권한이 있는 적격 Windows 10 라이선스 있음**을 선택합니다. 상자에 확인 표시가 나타나야 합니다.
    1. **다음: 디스크**를 선택합니다.

1. 그러면 VM 구성의 디스크 탭이 표시됩니다.  모든 설정을 기본값으로 유지하고 **다음: 네트워킹 >** 을 선택합니다.

1. 그러면 VM 구성의 네트워킹 탭이 표시됩니다.  다음 정보를 입력합니다(아래에 나와 있지 않은 옵션의 경우 기본 설정 유지).
    1. NIC 네트워크 보안 그룹:  **없음**을 선택합니다.  참고: 없음을 선택하면 NIC에 NSG가 포함되지 않습니다.  데모의 후속 단계에서 NSG를 만든 후 해당 NSG에 VM NIC를 할당할 예정입니다.
    1. VM의 기타 설정은 기본값으로 유지할 것이므로 다음: **검토 + 만들기>** 를 선택합니다.

1. VM의 구성을 검토합니다.  이때 다음 몇 가지 사항을 주의해야 합니다. VM에는 공융 IP 주소가 설정되며 NIC 네트워크 보안 그룹은 추가되지 않습니다.  즉, 해당 VM은 보안상 위험해집니다.  후속 작업에서 이 문제를 해결하겠습니다. **만들기**를 선택합니다.  VM 배포가 완료되려면 몇 분 정도 걸릴 수 있습니다.

1. 네트워크 인터페이스 이름 **sc900-winvmXXX**를 확인합니다(여기서 XXX는 VM의 네트워크 인터페이스에 따라 달라짐).

1. VM 배포가 완료되면 **리소스로 이동**을 선택합니다.  그러면 SC900-WinVM 페이지가 표시됩니다.  공용 IP 주소를 확인합니다.

1. 왼쪽 탐색 패널에서 **네트워킹**을 선택하고 네트워크 인터페이스 **sc900-winvmXXX**를 확인합니다(여기서 XXX는 VM의 네트워크 인터페이스에 따라 달라짐).  인터페이스에는 인바운드 또는 아웃바운드 규칙이 연결되어 있지 않아야 합니다.  

1. 페이지 위쪽에서 **연결**을 선택합니다. VM에 연결할 수 있는지 확인해야 하기 때문입니다.
    1. 페이지 위쪽에서 **RDP**가 선택되어 있는지(밑줄이 표시되어 있는지) 확인합니다.
    1. IP 주소가 공용 IP 주소로 설정되어 있는지 확인합니다. 기본 포트 번호는 그대로 두고 **DRP 파일 다운로드**를 선택합니다.
    1. 다운로드한 파일을 **열고** 표시되는 창에서 **연결**을 선택합니다.
    1. 그러면 열리는 창에 자격 증명을 입력하라는 메시지가 표시됩니다. 기본 창에 PIN을 입력하라는 메시지가 표시되면 **다른 옵션 선택**을 선택하고 **다른 계정 사용**을 선택합니다.   그러면 자격 증명을 입력하라는 메시지가 표시됩니다.  사용자 이름으로는 **AzureUser**를 입력합니다.  암호로는 **SC900AzureLabs**를 입력합니다.
    1. 원격 데스크톱 연결 창이 열리고 '원격 컴퓨터의 ID를 확인할 수 없습니다.  연결하시겠습니까?'라는 메시지가 나타납니다.  **예**를 선택합니다.
    1. 그러면 방금 만든 Windows VM에 연결됩니다. Windows 설정을 완료합니다. 여기서는 RDP 및 흔히 사용되는 RDP 포트를 사용하여 VM에 연결했지만, 해당 VM에서는 모든 포트가 열려 있기 때문에 트래픽이 전혀 필터링되지 않습니다.  IP 주소가 표시된 페이지 위쪽 가운데에서 **X**를 선택하여 원격 데스크톱 연결을 닫습니다.  그러면 '원격 세션의 연결이 끊어집니다'라는 팝업 창이 표시됩니다. **확인**을 선택합니다.

1. 그러면 Azure Portal의 SC900-WinVM 페이지가 다시 표시됩니다.  다음 작업을 위해 이 브라우저 탭을 열어 두세요.

#### 데모 전 설정 2부:
네트워크 보안 그룹을 만듭니다. 해당 NSG에 VM의 네트워크 인터페이스를 할당하지는 마세요.  

1. 브라우저에서 SC900-WinVM – Microsoft Azure 탭을 엽니다.

1. 검색 상자(페이지 위쪽의 'Microsoft Azure' 옆에 있는 파란 막대)에 **네트워크 보안 그룹**을 입력하고 검색 결과에서 **네트워크 보안 그룹**을 선택합니다.  네트워크 보안 그룹 클래식을 선택하지 마세요.

1. 네트워크 보안 그룹 페이지 위쪽에서 **+ 만들기**를 선택합니다.

1. 네트워크 보안 그룹 만들기 페이지의 기본 탭에서 다음 설정을 지정합니다.
    1. 구독:  Azure Pass - 스폰서쉽
    1. 리소스 그룹:  **LabsSC900-RG**
    1. 이름:  **NSG-SC900**
    1. 지역:  기본값인 **(미국) 미국 동부** 유지
    1. **검토 + 만들기**, **만들기**를 차례로 선택합니다.

1. 배포가 완료되면 **리소스로 이동**을 선택하여 모든 항목이 올바르게 설정되었는지 확인합니다.  NSG에는 기본 인바운드 규칙과 기본 아웃바운드 규칙이 각각 3개씩 연결되어 있어야 하며 서브넷과 인터페이스는 연결되어 있지 않아야 합니다.  Azure Portal의 **홈** 페이지로 다시 이동합니다.  

#### 데모
NSG의 설정을 살펴봅니다.  여기서는 VM 인터페이스에 아직 할당되지 않은 기존 NSG(위의 설정 단계에서 만든 NSG)의 설정을 살펴봅니다. 그런 다음 NSG에 인터페이스를 연결하는 프로세스와 인바운드 및 아웃바운드 규칙을 만드는 프로세스를 살펴봅니다.

1. 브라우저 탭에서 **홈 - Microsoft Azure**를 엽니다.  이전에 해당 탭을 닫았다면 브라우저 페이지를 열고 주소 표시줄에 portal.azure.com을 입력하여 다시 로그인합니다.

1. 검색 상자(페이지 위쪽의 'Microsoft Azure' 옆에 있는 파란 막대)에 **네트워크 보안 그룹**을 입력하고 검색 결과에서 **네트워크 보안 그룹**을 선택합니다.  네트워크 보안 그룹 클래식을 선택하지 마세요.

1. NSG 페이지에서 설정 과정에서 만든 NSG인 **NSG-SC900**을 선택합니다.

1. 왼쪽 탐색 패널의 **개요** 탭이 강조 표시됩니다.  NSG의 기본 인바운드 및 아웃바운드 규칙을 살펴봅니다. 설정 작업에서 NSG를 만들었으며 트래픽을 필터링하는 기본 규칙이 있지만, 해당 NSG에 인터페이스는 연결되지 않았습니다. 따라서 페이지 오른쪽 위에 "연결 대상: 서브넷 0개, 네트워크 인터페이스 0개"가 표시됩니다.  NSG는 네트워크 인터페이스에 할당해야 정상 작동합니다.  여기서는 앞에서 만든 VM의 네트워크 인터페이스에 NSG를 할당합니다.

1. NSG-SC900 페이지 왼쪽 탐색 창의 설정 아래에서 **네트워크 인터페이스**를 선택합니다.

1. 검색 상자 위쪽의 **+ 연결**을 선택하고 드롭다운에서 **sc900-winvmXXX** (여기서 XXX는 VM의 네트워크 인터페이스에 따라 달라짐)를 선택한 후에 **확인**을 선택합니다. 인터페이스가 연결되면 화면 오른쪽 위에 알림 상자가 표시됩니다. NSG에 연결된 인터페이스는 목록에 표시됩니다.

1. **개요** 탭으로 다시 이동합니다.  페이지 오른쪽 위에 "연결 대상: 서브넷 0개, 네트워크 인터페이스 1개"가 표시됩니다. 즉, NSG에 인터페이스가 할당된 것입니다. 기본 규칙에 대해서도 부연 설명합니다. 인바운드 트래픽의 경우 다른 Azure Virtual Network 및 Azure Load Balancer에서 전송된 트래픽만 허용됩니다. VM으로 전송되는 기타 모든 인바운드 트래픽은 거부됩니다. 기본 아웃바운드 규칙에 대해서도 설명합니다.  다른 VNet으로 전송하는 아웃바운드 트래픽 및 아웃바운드 인터넷 트래픽만 허용됩니다.  데모 중에 잠시 시간을 할애하여 인바운드 트래픽이 거부되는 방식을 시연하는 것이 좋습니다.
    1. 페이지 위쪽의 검색 표시줄에 **가상 머신**을 입력한 후 검색 결과에서 가상 머신을 선택합니다.
    1. 가상 머신 페이지에서 **SC900-WinVM**을 선택합니다.
    1. SC900-WinVM 페이지 위쪽에서 **연결**을 선택하고 **RDP**를 선택합니다.
    1. IP 주소가 공용 IP 주소로 설정되어 있는지 확인합니다. 기본 포트 번호는 그대로 두고 **DRP 파일 다운로드**를 선택합니다.
    1. 다운로드한 파일을 **열고** **연결**을 선택합니다.
    1. 연결을 시도하고 몇 초 정도 지나면 원격 데스크톱이 원격 컴퓨터에 연결할 수 없음을 나타내는 오류 메시지가 표시됩니다. **확인**을 선택합니다.

1. 지금까지 NSG 기본 인바운드 규칙을 살펴보았습니다. 다음으로는 인바운드 RDP 트래픽을 허용하는 새 규칙을 만듭니다.  기존 기본 규칙을 삭제할 수는 없으며 우선 순위가 더 높은 새 규칙을 만들어야 함을 설명합니다.
    1. 왼쪽 탐색 패널의 설정 아래에서 **네트워킹**을 선택합니다.  그러면 VM의 네트워킹 페이지가 표시됩니다. 이 페이지에서 인바운드 규칙과 아웃바운드 규칙을 만들 수도 있지만, 이 데모는 NSG 관련 내용이므로 여기서는 NSG 페이지로 다시 이동합니다.  창 가운데에 있는 **NSG-SC900** 링크를 선택합니다.

1. 그러면 NSG 개요 페이지가 표시됩니다.  NSG 관련 정보를 살펴봅니다. NSG 페이지 왼쪽 탐색 패널에서 설정 아래의 **인바운드 보안 규칙**을 선택한 다음 페이지 위쪽에서 **+ 추가**를 선택합니다. 인바운드 보안 규칙 추가 페이지의 다양한 설정에 대해 설명합니다. 다음 설정을 사용하여 인바운드 RDP 트래픽을 허용하는 규칙을 실제로 만들어 보는 것이 좋습니다.
    1. 원본: **모두**
    1. 소스 포트 범위: **\***
    1. 대상: **모두**
    1. 서비스: **RDP**
    1. 작업: **허용**
    1. 우선 순위: **300**. 참고: 번호가 낮은 규칙이 우선 순위가 더 높으며 먼저 처리됩니다. 그러므로 이 새 규칙의 우선 순위는 모든 인바운드 트래픽을 거부하는 기존 규칙의 우선 순위보다 높아야 합니다.
    1. 이름: **AllowRDP**
    1. **추가**를 선택합니다.
    1. 프로비전된 규칙은 인바운드 규칙 목록에 표시됩니다.

1. 이번에는 **아웃바운드 보안 규칙**을 확인합니다.  페이지 위쪽에서 **+ 추가** 를 선택하고 다양한 설정에 대해 설명합니다.  마찬가지로 규칙을 직접 만들어 보는 것이 좋습니다. 아래 설정을 사용하는 경우 아웃바운드 인터넷 트래픽을 거부하는 규칙이 작성됩니다.
    1. 원본: **모두**
    1. 소스 포트 범위: **\***
    1. 대상: **서비스 태그**
    1. 대상 서비스 태그: **인터넷**
    1. 서비스: **사용자 지정** (기본값 유지)
    1. 대상 포트 범위: **\*** (대상 포트 범위 필드에는 별표를 추가해야 함)
    1. 프로토콜: **모두**
    1. 작업: **거부**
    1. 우선 순위: **4000** (이 규칙의 우선 순위는 인터넷 아웃바운드 트래픽을 허용하는 기존 규칙의 우선 순위보다 높아야 함을 언급)
    1. 이름: **DenyInternet**
    1. **추가**를 선택합니다.
    1. 프로비전된 규칙은 아웃바운드 규칙 목록에 표시됩니다.

1. 이제 VM으로 돌아와 규칙을 테스트합니다.  페이지 위쪽의 '아웃바운드 보안 규칙' 위에서 **SC900-VM**을 선택합니다.

1. 인바운드 규칙을 테스트합니다. 이렇게 하려면 RDP를 사용하여 VM에 연결할 수 있음을 확인합니다.
    1. 왼쪽 탐색 패널에서 **연결**을 선택합니다.
    1. IP 주소가 공용 IP 주소로 설정되어 있는지 확인합니다. 기본 포트 번호는 그대로 두고 **DRP 파일 다운로드**를 선택합니다.
    1. 다운로드한 파일을 **열고 연결**을 선택합니다.
    1. 그러면 자격 증명을 입력하라는 메시지가 표시됩니다. 사용자 이름으로는 **AzureUser**를 입력합니다. 암호로는 **SC900AzureLabs**를 입력합니다.  자격 증명 입력 창에 PIN을 입력하라는 메시지가 표시되면 **다른 옵션 선택**을 선택하고 **다른 계정 사용**을 선택합니다.
    1. 원격 데스크톱 연결 창이 열리고 '원격 컴퓨터의 ID를 확인할 수 없습니다. 연결하시겠습니까?'라는 메시지가 나타납니다. **예**를 선택합니다.
    1. 이제 VM에 연결되었습니다. 이번에 VM에 연결할 수 있었던 이유는, 방금 만든 인바운드 트래픽 규칙이 RDP를 통해 VM으로 전송되는 인바운드 트래픽을 허용하기 때문입니다.

1. 이번에는 아웃바운드 NSG 규칙을 테스트합니다.
    1. VM에서 Edge 브라우저를 엽니다.
    1. **https://www.bing.com** 을 입력합니다. 페이지가 표시되지 않아야 합니다. 참고: 인터넷에 연결할 수 있으며 아웃바운드 규칙의 모든 매개 변수가 올바르게 설정되었음을 확인했다면, 규칙이 적용되는 데 몇 분 정도 걸리기 때문일 수 있습니다. 이 경우에는 몇 분 정도 기다렸다가 다시 시도하세요.

1. IP 주소가 표시된 페이지 위쪽 가운데에서 **X** 를 선택하여 원격 데스크톱 연결을 닫습니다. 그러면 '원격 세션의 연결이 끊어집니다'라는 팝업 창이 표시됩니다. **확인**을 선택합니다.

1. 페이지 위쪽의 파란색 막대에서 **Microsoft Azure**를 선택하여 Azure Portal의 홈 페이지로 돌아옵니다.

#### 리소스 정리
**중요**: 이 작업에서는 리소스 그룹 및 해당 그룹에 포함된 모든 리소스를 삭제합니다.   추가 비용이 발생하지 않도록 하려면 이 작업을 반드시 수행해야 합니다.

1. 브라우저에서 SC900-WinVM – Microsoft Azure 탭을 엽니다.

1. 페이지 왼쪽 위에서 **모든 서비스**를 선택합니다.

1. 모든 서비스 옆의 서비스 필터 상자에 **리소스 그룹**을 입력한 후 결과에서 **리소스 그룹**을 선택합니다.

1. **LabsSC900-RG**를 선택합니다.

1. LabsSC900-RG 페이지 위쪽 가운데의 **리소스 그룹 삭제**를 선택합니다.

1. 그러면 열리는 창에서 리소스 그룹 이름 **LabsSC900-RG**를 입력하여 리소스 그룹 및 모든 해당 리소스의 삭제를 확인하고 페이지 아래쪽에서 **삭제**를 선택합니다.

1. 모든 리소스와 리소스 그룹을 삭제하는 데는 몇 분 정도 걸릴 수 있습니다.

#### 복습

이 데모에서는 NSG와 연관된 정보 및 설정을 살펴보았습니다. 그리고 NSG에 인터페이스를 연결하는 프로세스와 기본 인바운드 및 아웃바운드 규칙을 확인했으며, 마지막으로 새 규칙을 만드는 단계를 진행했습니다.
